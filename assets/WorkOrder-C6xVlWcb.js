import{u as me}from"./device-Cstu3Uc2.js";import{d as fe,p as ge,r as v,m as k,o as ye,c as C,b as t,j as s,n as f,l as o,A as r,t as n,w as be,aA as ke,E as _,C as h,y as he,W as we,aD as Ce,aE as xe,a7 as Ve,B as u,aF as Ne,af as Te,aG as De,k as x,f as c,V as A,_ as Se}from"./index-BFAmLiXm.js";const $e={class:"page-container"},Oe={class:"work-order"},ze={class:"grid grid-cols-4",style:{"margin-bottom":"20px"}},We={class:"icon-wrapper"},Ue={class:"info"},Me={class:"value"},Be={class:"icon-wrapper"},Le={class:"info"},Ee={class:"value"},He={class:"icon-wrapper"},je={class:"info"},Ae={class:"value"},Pe={class:"icon-wrapper"},Fe={class:"info"},Ge={class:"value"},Ie={class:"module-card"},Re={class:"toolbar"},qe={class:"right-tools"},Je={class:"status-indicator"},Ke={class:"title-cell"},Qe={class:"wo-id"},Xe={class:"site-text"},Ye={class:"user-cell"},Ze={class:"time-cell"},et={class:"create-time"},tt={style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},lt={key:0,class:"sc2-info-panel detail-container"},st={class:"header-main"},at={class:"wo-id-badge"},ot={class:"title"},nt={class:"detail-body"},it={class:"info-grid"},dt={class:"info-item"},rt={class:"val highlight"},ut={class:"info-item"},ct={class:"val"},pt={class:"info-item"},vt={class:"val"},_t={class:"info-item"},mt={class:"val"},ft={class:"info-item"},gt={class:"val"},yt={class:"info-item"},bt={class:"val text-danger"},kt={class:"message-box"},ht={class:"content"},wt={key:0,class:"process-section"},Ct=fe({__name:"WorkOrder",setup(xt){const $=me(),{workOrders:w,loading:P}=ge($),V=v(""),N=v(""),p=v(""),O=v(1),T=v(20),g=v(!1),i=v(null),y=v(!1),D=v("in-progress"),z=v(""),M=k(()=>{let l=w.value;if(V.value){const e=V.value.toLowerCase();l=l.filter(d=>d.title.toLowerCase().includes(e)||d.deviceName.toLowerCase().includes(e)||d.roomName&&d.roomName.toLowerCase().includes(e))}return N.value&&(l=l.filter(e=>e.type===N.value)),p.value&&(l=l.filter(e=>e.status===p.value)),l}),F=k(()=>{const l=(O.value-1)*T.value,e=l+T.value;return M.value.slice(l,e)}),G=k(()=>w.value.length),I=k(()=>w.value.filter(l=>l.status==="pending").length),R=k(()=>w.value.filter(l=>l.status==="in-progress").length),q=k(()=>w.value.filter(l=>l.status==="completed").length),B=l=>({repair:"维修",maintenance:"保养",inspection:"巡检",emergency:"紧急"})[l]||l,J=l=>({repair:"warning",maintenance:"info",inspection:"success",emergency:"danger"})[l]||"",K=l=>({pending:"待处理",assigned:"已分配","in-progress":"进行中",completed:"已完成",cancelled:"已取消"})[l]||l,Q=l=>({pending:"danger",assigned:"warning","in-progress":"primary",completed:"success",cancelled:"info"})[l]||"",L=l=>new Date(l).toLocaleString("zh-CN"),X=l=>{const e=new Date(l);return`${e.getMonth()+1}-${e.getDate()} ${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`},W=l=>!l.deadline||l.status==="completed"?!1:new Date>new Date(l.deadline),Y=l=>W(l)?"overdue":"normal",Z=l=>{if(!l.deadline)return"";if(W(l))return"已超时";const e=new Date(l.deadline).getTime()-new Date().getTime(),d=Math.floor(e/(1e3*60*60));return d<24?`剩余 ${d}h`:`剩余 ${Math.floor(d/24)}天`},ee=l=>{i.value=l,y.value=!1,g.value=!0},te=l=>{i.value=l,y.value=!0,D.value=l.status==="pending"?"assigned":"in-progress",z.value="",g.value=!0},le=()=>{y.value=!0},se=()=>{A.info("新建工单功能开发中...")},ae=async()=>{i.value&&(await $.updateWorkOrderStatus(i.value.id,D.value),A.success("处理成功"),g.value=!1)};return ye(()=>{$.fetchWorkOrders()}),(l,e)=>{const d=r("el-icon"),E=r("el-input"),S=r("el-option"),oe=r("el-select"),b=r("el-button"),m=r("el-table-column"),H=r("el-tag"),ne=r("el-avatar"),ie=r("el-table"),de=r("el-pagination"),re=r("el-divider"),U=r("el-radio"),ue=r("el-radio-group"),j=r("el-form-item"),ce=r("el-form"),pe=r("el-dialog"),ve=ke("loading");return c(),C("div",$e,[t("div",Oe,[t("div",ze,[t("div",{class:f(["stat-card-item",{active:p.value===""}]),onClick:e[0]||(e[0]=a=>p.value="")},[t("div",We,[s(d,null,{default:o(()=>[s(_(he))]),_:1})]),t("div",Ue,[e[12]||(e[12]=t("div",{class:"label"},"总工单",-1)),t("div",Me,n(G.value),1)])],2),t("div",{class:f(["stat-card-item warning",{active:p.value==="pending"}]),onClick:e[1]||(e[1]=a=>p.value="pending")},[t("div",Be,[s(d,null,{default:o(()=>[s(_(we))]),_:1})]),t("div",Le,[e[13]||(e[13]=t("div",{class:"label"},"待处理",-1)),t("div",Ee,n(I.value),1)])],2),t("div",{class:f(["stat-card-item info",{active:p.value==="in-progress"}]),onClick:e[2]||(e[2]=a=>p.value="in-progress")},[t("div",He,[s(d,null,{default:o(()=>[s(_(Ce))]),_:1})]),t("div",je,[e[14]||(e[14]=t("div",{class:"label"},"进行中",-1)),t("div",Ae,n(R.value),1)])],2),t("div",{class:f(["stat-card-item success",{active:p.value==="completed"}]),onClick:e[3]||(e[3]=a=>p.value="completed")},[t("div",Pe,[s(d,null,{default:o(()=>[s(_(xe))]),_:1})]),t("div",Fe,[e[15]||(e[15]=t("div",{class:"label"},"已完成",-1)),t("div",Ge,n(q.value),1)])],2)]),t("div",Ie,[e[20]||(e[20]=t("div",{class:"module-header"},[t("span",{class:"title"},"工单管理中心")],-1)),t("div",Re,[e[17]||(e[17]=t("div",{class:"left-tools"},null,-1)),t("div",qe,[s(E,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=a=>V.value=a),placeholder:"搜索工单/设备/站点",style:{width:"250px"},clearable:""},{prefix:o(()=>[s(d,null,{default:o(()=>[s(_(Ve))]),_:1})]),_:1},8,["modelValue"]),s(oe,{modelValue:N.value,"onUpdate:modelValue":e[5]||(e[5]=a=>N.value=a),placeholder:"类型",clearable:"",style:{width:"120px"}},{default:o(()=>[s(S,{label:"维修",value:"repair"}),s(S,{label:"保养",value:"maintenance"}),s(S,{label:"巡检",value:"inspection"}),s(S,{label:"紧急",value:"emergency"})]),_:1},8,["modelValue"]),s(b,{type:"primary",onClick:se},{default:o(()=>[s(d,null,{default:o(()=>[s(_(Ne))]),_:1}),e[16]||(e[16]=u(" 新建工单 ",-1))]),_:1})])]),be((c(),h(ie,{data:F.value,stripe:"",style:{width:"100%"},class:"sc2-table"},{default:o(()=>[s(m,{label:"状态",width:"80",align:"center"},{default:o(({row:a})=>[t("div",Je,[a.priority==="urgent"?(c(),h(d,{key:0,class:"priority-icon urgent",title:"紧急"},{default:o(()=>[s(_(Te))]),_:1})):a.priority==="high"?(c(),h(d,{key:1,class:"priority-icon high",title:"高"},{default:o(()=>[s(_(De))]),_:1})):(c(),C("div",{key:2,class:f(["status-dot",a.status])},null,2))])]),_:1}),s(m,{label:"工单信息","min-width":"250"},{default:o(({row:a})=>[t("div",Ke,[t("span",{class:f(["wo-title",{"text-danger":W(a)}])},n(a.title),3),t("span",Qe,n(a.id),1)])]),_:1}),s(m,{prop:"roomName",label:"所属站点",width:"180"},{default:o(({row:a})=>[t("span",Xe,n(a.roomName),1)]),_:1}),s(m,{prop:"deviceName",label:"关联对象",width:"150","show-overflow-tooltip":""}),s(m,{prop:"type",label:"类型",width:"100"},{default:o(({row:a})=>[s(H,{type:J(a.type),effect:"dark"},{default:o(()=>[u(n(B(a.type)),1)]),_:2},1032,["type"])]),_:1}),s(m,{prop:"assignee",label:"负责人",width:"100"},{default:o(({row:a})=>[t("div",Ye,[s(ne,{size:24,icon:"UserFilled",class:"small-avatar"}),t("span",null,n(a.assignee),1)])]),_:1}),s(m,{label:"时效",width:"160"},{default:o(({row:a})=>[t("div",Ze,[t("div",et,n(X(a.createTime)),1),a.status!=="completed"?(c(),C("div",{key:0,class:f(["deadline-tag",Y(a)])},n(Z(a)),3)):x("",!0)])]),_:1}),s(m,{label:"操作",fixed:"right",width:"150"},{default:o(({row:a})=>[s(b,{size:"small",link:"",type:"primary",onClick:_e=>ee(a)},{default:o(()=>[...e[18]||(e[18]=[u("详情",-1)])]),_:1},8,["onClick"]),a.status!=="completed"&&a.status!=="cancelled"?(c(),h(b,{key:0,size:"small",link:"",type:"warning",onClick:_e=>te(a)},{default:o(()=>[...e[19]||(e[19]=[u(" 处理 ",-1)])]),_:1},8,["onClick"])):x("",!0)]),_:1})]),_:1},8,["data"])),[[ve,_(P)]]),t("div",tt,[s(de,{"current-page":O.value,"onUpdate:currentPage":e[6]||(e[6]=a=>O.value=a),"page-size":T.value,"onUpdate:pageSize":e[7]||(e[7]=a=>T.value=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:M.value.length},null,8,["current-page","page-size","total"])])]),s(pe,{modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=a=>g.value=a),title:y.value?"工单处理":"工单详情",width:"700px",class:"sc2-dialog"},{footer:o(()=>[s(b,{onClick:e[10]||(e[10]=a=>g.value=!1)},{default:o(()=>[...e[32]||(e[32]=[u("关闭",-1)])]),_:1}),y.value?(c(),h(b,{key:0,type:"primary",onClick:ae},{default:o(()=>[...e[33]||(e[33]=[u("提交处理",-1)])]),_:1})):i.value?.status!=="completed"?(c(),h(b,{key:1,type:"warning",onClick:le},{default:o(()=>[...e[34]||(e[34]=[u("去处理",-1)])]),_:1})):x("",!0)]),default:o(()=>[i.value?(c(),C("div",lt,[t("div",{class:f(["detail-header",i.value.priority])},[t("div",st,[t("span",at,n(i.value.id),1),t("span",ot,n(i.value.title),1)]),s(H,{type:Q(i.value.status)},{default:o(()=>[u(n(K(i.value.status)),1)]),_:1},8,["type"])],2),t("div",nt,[t("div",it,[t("div",dt,[e[21]||(e[21]=t("span",{class:"label"},"所属站点:",-1)),t("span",rt,n(i.value.roomName),1)]),t("div",ut,[e[22]||(e[22]=t("span",{class:"label"},"关联设备:",-1)),t("span",ct,n(i.value.deviceName),1)]),t("div",pt,[e[23]||(e[23]=t("span",{class:"label"},"工单类型:",-1)),t("span",vt,n(B(i.value.type)),1)]),t("div",_t,[e[24]||(e[24]=t("span",{class:"label"},"负责人:",-1)),t("span",mt,n(i.value.assignee),1)]),t("div",ft,[e[25]||(e[25]=t("span",{class:"label"},"创建时间:",-1)),t("span",gt,n(L(i.value.createTime)),1)]),t("div",yt,[e[26]||(e[26]=t("span",{class:"label"},"截止时间:",-1)),t("span",bt,n(L(i.value.deadline||"")),1)])]),t("div",kt,[e[27]||(e[27]=t("div",{class:"label"},"工单描述",-1)),t("div",ht,n(i.value.description),1)]),y.value?(c(),C("div",wt,[s(re,{"content-position":"left"},{default:o(()=>[...e[28]||(e[28]=[u("处理反馈",-1)])]),_:1}),s(ce,{"label-width":"80px"},{default:o(()=>[s(j,{label:"流转动作"},{default:o(()=>[s(ue,{modelValue:D.value,"onUpdate:modelValue":e[8]||(e[8]=a=>D.value=a)},{default:o(()=>[s(U,{label:"in-progress"},{default:o(()=>[...e[29]||(e[29]=[u("开始处理",-1)])]),_:1}),s(U,{label:"completed"},{default:o(()=>[...e[30]||(e[30]=[u("完成工单",-1)])]),_:1}),s(U,{label:"transfer"},{default:o(()=>[...e[31]||(e[31]=[u("转派",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(j,{label:"处理说明"},{default:o(()=>[s(E,{type:"textarea",modelValue:z.value,"onUpdate:modelValue":e[9]||(e[9]=a=>z.value=a),rows:"3",placeholder:"请���入处理情况..."},null,8,["modelValue"])]),_:1})]),_:1})])):x("",!0)])])):x("",!0)]),_:1},8,["modelValue","title"])])])}}}),Tt=Se(Ct,[["__scopeId","data-v-730ec35b"]]);export{Tt as default};
