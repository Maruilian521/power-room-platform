import{d as ne,r as n,m as O,o as de,c as M,b as a,j as l,l as o,A as d,t as p,w as ue,E as g,a7 as ie,aA as re,C as $,aQ as pe,s as ce,aJ as ve,aR as me,aS as fe,O as _e,B as u,k as be,n as ge,V as S,F as ke,i as Ve,f as C,_ as we}from"./index-BFAmLiXm.js";const ye={class:"page-container spare-parts"},xe={class:"stats-dashboard grid grid-cols-5 gap-4 mb-4"},Se={class:"stat-card-item primary"},Ce={class:"icon-wrapper"},Ue={class:"info"},he={class:"value"},ze={class:"stat-card-item warning"},Oe={class:"icon-wrapper"},Ie={class:"info"},De={class:"value"},$e={class:"stat-card-item danger"},je={class:"icon-wrapper"},Be={class:"info"},Pe={class:"value"},Te={class:"stat-card-item success"},Ae={class:"icon-wrapper"},Fe={class:"info"},Me={class:"value text-sm"},Ne={class:"stat-card-item info"},We={class:"icon-wrapper"},Ee={class:"info"},Le={class:"value"},He={class:"module-card flex-1 flex flex-col overflow-hidden"},Je={class:"module-header"},Qe={class:"header-left"},Re={class:"header-right toolbar-actions"},qe={class:"filter-set"},Ge={class:"btn-set"},Ke={class:"name-text"},Xe={class:"stock-bar-container"},Ye={class:"stock-info"},Ze={class:"min-stock"},el={class:"time-text"},ll={class:"pagination-wrapper mt-4 flex justify-end"},tl=ne({__name:"SpareParts",setup(al){const I=n(!1),k=n([]),V=n(""),U=n(""),w=n(""),D=n(1),h=n(15),N=O(()=>k.value.reduce((s,e)=>s+e.stock,0)),W=O(()=>k.value.filter(s=>s.stock<s.minStock).length),E=n(5),L=n(1258e3),H=n(42),y=n(!1),x=n(!1),c=n({name:"",amount:1,location:"",supplier:""}),f=n({workOrderId:"",spareId:"",amount:1}),J=async()=>{I.value=!0;try{const e=await(await fetch("/api/spare-parts")).json();k.value=e.data}finally{I.value=!1}},j=O(()=>k.value.filter(s=>{const e=!V.value||s.name.includes(V.value)||s.location.includes(V.value),m=!U.value||s.type===U.value;let v=!0;return w.value==="low"&&(v=s.stock<s.minStock&&s.stock>0),w.value==="out"&&(v=s.stock===0),w.value==="normal"&&(v=s.stock>=s.minStock),e&&m&&v})),Q=O(()=>{const s=(D.value-1)*h.value;return j.value.slice(s,s+h.value)}),R=s=>new Date(s).toLocaleDateString(),q=(s,e)=>s===0?"text-gray-500":s<e?"text-danger font-bold":"text-success font-bold",G=()=>y.value=!0,K=()=>x.value=!0,X=()=>{S.success("入库成功"),y.value=!1},Y=()=>{S.success("出库成功，已关联工单"),x.value=!1},Z=s=>S.info(`查看 ${s.name} ���水记录`),ee=()=>S.info("盘点功能开发中"),le=()=>S.warning("报废需审批");return de(()=>{J()}),(s,e)=>{const m=d("el-icon"),v=d("el-input"),i=d("el-option"),z=d("el-select"),r=d("el-button"),B=d("el-tag"),_=d("el-table-column"),te=d("el-progress"),ae=d("el-table"),oe=d("el-pagination"),b=d("el-form-item"),P=d("el-input-number"),T=d("el-form"),A=d("el-dialog"),se=re("loading");return C(),M("div",ye,[a("div",xe,[a("div",Se,[a("div",Ce,[l(m,null,{default:o(()=>[l(g(pe))]),_:1})]),a("div",Ue,[e[18]||(e[18]=a("div",{class:"label"},"库存总量",-1)),a("div",he,p(N.value),1)])]),a("div",ze,[a("div",Oe,[l(m,null,{default:o(()=>[l(g(ce))]),_:1})]),a("div",Ie,[e[19]||(e[19]=a("div",{class:"label"},"库存告警",-1)),a("div",De,p(W.value),1)])]),a("div",$e,[a("div",je,[l(m,null,{default:o(()=>[l(g(ve))]),_:1})]),a("div",Be,[e[20]||(e[20]=a("div",{class:"label"},"即将过期",-1)),a("div",Pe,p(E.value),1)])]),a("div",Te,[a("div",Ae,[l(m,null,{default:o(()=>[l(g(me))]),_:1})]),a("div",Fe,[e[21]||(e[21]=a("div",{class:"label"},"库存总值",-1)),a("div",Me,"¥"+p(L.value.toLocaleString()),1)])]),a("div",Ne,[a("div",We,[l(m,null,{default:o(()=>[l(g(fe))]),_:1})]),a("div",Ee,[e[22]||(e[22]=a("div",{class:"label"},"本月消耗",-1)),a("div",Le,p(H.value),1)])])]),a("div",He,[a("div",Je,[a("div",Qe,[l(m,null,{default:o(()=>[l(g(_e))]),_:1}),e[23]||(e[23]=a("span",null,"备件库存列表",-1))]),a("div",Re,[a("div",qe,[l(v,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t),placeholder:"备件名称/型号/库位...","prefix-icon":g(ie),class:"sc2-input search-wide"},null,8,["modelValue","prefix-icon"]),l(z,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=t=>U.value=t),placeholder:"备件类型",class:"sc2-select w-32",clearable:""},{default:o(()=>[l(i,{label:"全部",value:""}),l(i,{label:"开关柜",value:"开关柜"}),l(i,{label:"变压器",value:"变压器"}),l(i,{label:"保护装置",value:"保护装置"}),l(i,{label:"辅助设备",value:"辅助设备"})]),_:1},8,["modelValue"]),l(z,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),placeholder:"状态",class:"sc2-select w-32",clearable:""},{default:o(()=>[l(i,{label:"充足",value:"normal"}),l(i,{label:"告警",value:"low"}),l(i,{label:"缺货",value:"out"})]),_:1},8,["modelValue"])]),a("div",Ge,[l(r,{type:"primary",icon:"Plus",onClick:G},{default:o(()=>[...e[24]||(e[24]=[u("入库",-1)])]),_:1}),l(r,{type:"warning",icon:"Minus",onClick:K},{default:o(()=>[...e[25]||(e[25]=[u("出库",-1)])]),_:1}),l(r,{class:"sc2-btn-outline",icon:"Download"},{default:o(()=>[...e[26]||(e[26]=[u("导出",-1)])]),_:1})])])]),ue((C(),$(ae,{data:Q.value,class:"sc2-table flex-1",stripe:""},{default:o(()=>[l(_,{prop:"name",label:"备件名称","min-width":"150","show-overflow-tooltip":""},{default:o(({row:t})=>[a("span",Ke,p(t.name),1),t.stock<t.minStock?(C(),$(B,{key:0,size:"small",type:"danger",effect:"dark",class:"ml-2"},{default:o(()=>[...e[27]||(e[27]=[u("缺货",-1)])]),_:1})):be("",!0)]),_:1}),l(_,{prop:"type",label:"类型",width:"120"},{default:o(({row:t})=>[l(B,{class:"sc2-tag type-tag"},{default:o(()=>[u(p(t.type),1)]),_:2},1024)]),_:1}),l(_,{label:"库存状态",width:"200"},{default:o(({row:t})=>[a("div",Xe,[a("div",Ye,[a("span",{class:ge(q(t.stock,t.minStock))},p(t.stock),3),e[28]||(e[28]=a("span",{class:"divider"},"/",-1)),a("span",Ze,"最低: "+p(t.minStock),1)]),l(te,{percentage:Math.min(t.stock/(t.minStock*2)*100,100),status:t.stock<t.minStock?"exception":"success","show-text":!1,"stroke-width":4},null,8,["percentage","status"])])]),_:1}),l(_,{prop:"location",label:"存放位置",width:"150","show-overflow-tooltip":""}),l(_,{prop:"supplier",label:"供应商",width:"180","show-overflow-tooltip":""}),l(_,{label:"最近更新",width:"160"},{default:o(({row:t})=>[a("span",el,p(R(t.lastUpdate)),1)]),_:1}),l(_,{label:"操作",width:"180",fixed:"right"},{default:o(({row:t})=>[l(r,{link:"",type:"primary",size:"small",onClick:F=>Z(t)},{default:o(()=>[...e[29]||(e[29]=[u("流水",-1)])]),_:1},8,["onClick"]),l(r,{link:"",type:"warning",size:"small",onClick:e[3]||(e[3]=F=>ee())},{default:o(()=>[...e[30]||(e[30]=[u("盘点",-1)])]),_:1}),l(r,{link:"",type:"danger",size:"small",onClick:e[4]||(e[4]=F=>le())},{default:o(()=>[...e[31]||(e[31]=[u("报废",-1)])]),_:1})]),_:1})]),_:1},8,["data"])),[[se,I.value]]),a("div",ll,[l(oe,{"current-page":D.value,"onUpdate:currentPage":e[5]||(e[5]=t=>D.value=t),"page-size":h.value,"onUpdate:pageSize":e[6]||(e[6]=t=>h.value=t),layout:"total, sizes, prev, pager, next, jumper",total:j.value.length},null,8,["current-page","page-size","total"])])]),l(A,{modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=t=>y.value=t),title:"备件入库登记",width:"500px",class:"sc2-dialog"},{footer:o(()=>[l(r,{onClick:e[11]||(e[11]=t=>y.value=!1)},{default:o(()=>[...e[32]||(e[32]=[u("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:X},{default:o(()=>[...e[33]||(e[33]=[u("确认入库",-1)])]),_:1})]),default:o(()=>[l(T,{model:c.value,"label-width":"80px"},{default:o(()=>[l(b,{label:"备件名称"},{default:o(()=>[l(v,{modelValue:c.value.name,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value.name=t),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),l(b,{label:"入库数量"},{default:o(()=>[l(P,{modelValue:c.value.amount,"onUpdate:modelValue":e[8]||(e[8]=t=>c.value.amount=t),min:1},null,8,["modelValue"])]),_:1}),l(b,{label:"存放位置"},{default:o(()=>[l(v,{modelValue:c.value.location,"onUpdate:modelValue":e[9]||(e[9]=t=>c.value.location=t),placeholder:"例如: A-01-02"},null,8,["modelValue"])]),_:1}),l(b,{label:"供应商"},{default:o(()=>[l(v,{modelValue:c.value.supplier,"onUpdate:modelValue":e[10]||(e[10]=t=>c.value.supplier=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(A,{modelValue:x.value,"onUpdate:modelValue":e[17]||(e[17]=t=>x.value=t),title:"备件领用出库",width:"500px",class:"sc2-dialog"},{footer:o(()=>[l(r,{onClick:e[16]||(e[16]=t=>x.value=!1)},{default:o(()=>[...e[34]||(e[34]=[u("取消",-1)])]),_:1}),l(r,{type:"warning",onClick:Y},{default:o(()=>[...e[35]||(e[35]=[u("确认出库",-1)])]),_:1})]),default:o(()=>[l(T,{model:f.value,"label-width":"80px"},{default:o(()=>[l(b,{label:"关联工单"},{default:o(()=>[l(z,{modelValue:f.value.workOrderId,"onUpdate:modelValue":e[13]||(e[13]=t=>f.value.workOrderId=t),placeholder:"选择工单",class:"w-full"},{default:o(()=>[l(i,{label:"WO-20231122-01 (维修)",value:"WO-01"}),l(i,{label:"WO-20231122-02 (保养)",value:"WO-02"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"领用备件"},{default:o(()=>[l(z,{modelValue:f.value.spareId,"onUpdate:modelValue":e[14]||(e[14]=t=>f.value.spareId=t),placeholder:"选择备件",class:"w-full"},{default:o(()=>[(C(!0),M(ke,null,Ve(k.value,t=>(C(),$(i,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"领用数量"},{default:o(()=>[l(P,{modelValue:f.value.amount,"onUpdate:modelValue":e[15]||(e[15]=t=>f.value.amount=t),min:1},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),sl=we(tl,[["__scopeId","data-v-0f7934ea"]]);export{sl as default};
