import{d as K,r as v,m as b,o as R,c as N,b as t,j as l,l as a,A as r,t as o,w as $,E as g,a7 as W,aA as X,C as w,af as Y,aa as Z,aH as ss,H as ts,B as n,aF as es,n as p,k as T,F as ls,i as as,f as _,_ as is}from"./index-BFAmLiXm.js";const os={class:"page-container ticket-page"},ns={class:"ticket-stats grid grid-cols-4"},ds={class:"stat-card-item danger"},us={class:"icon-wrapper"},rs={class:"info"},ps={class:"value"},cs={class:"stat-card-item success"},vs={class:"icon-wrapper"},_s={class:"info"},fs={class:"value"},gs={class:"stat-card-item info"},ms={class:"icon-wrapper"},ks={class:"info"},bs={class:"value"},ws={class:"stat-card-item primary"},ys={class:"icon-wrapper"},hs={class:"module-card main-area"},xs={class:"module-header"},Cs={class:"header-left"},zs={class:"header-right"},Ts={class:"ticket-no"},Vs={class:"person-row"},Ns={class:"name"},Ss={class:"time-range"},Ds={class:"person-row"},Ms={class:"person-row"},Bs={class:"pagination-wrapper"},Us={key:0,class:"ticket-viewer"},Fs={class:"process-stepper"},Os={class:"digital-ticket-paper"},Ps={class:"paper-header"},$s={class:"paper-no"},js={class:"paper-row"},As={class:"val"},Es={class:"paper-row"},Hs={class:"val"},Ls={class:"paper-row"},Is={class:"val content-box"},Qs={class:"paper-row"},qs={class:"val"},Gs={class:"paper-section"},Js={class:"sec-title"},Ks={class:"sec-content"},Rs={class:"idx"},Ws={class:"desc"},Xs=K({__name:"TicketManagement",setup(Ys){const y=v(!1),h=v("work"),m=v(""),k=v([]),V=v(!1),d=v(null),j=async()=>{y.value=!0;try{const s=await(await fetch("/api/tickets")).json();k.value=s.data}finally{y.value=!1}},S=b(()=>k.value.filter(i=>{const s=h.value==="work"?i.category==="work_1"||i.category==="work_2":i.category==="operation",f=!m.value||i.no.includes(m.value)||i.task.includes(m.value);return s&&f})),x=v(1),C=v(10),D=b(()=>{const i=(x.value-1)*C.value;return S.value.slice(i,i+C.value)}),A=b(()=>k.value.filter(i=>i.status==="audit").length),E=b(()=>k.value.filter(i=>i.status==="executing"||i.status==="permit").length),H=b(()=>k.value.filter(i=>i.status==="finished").length),L=()=>{x.value=1},z=i=>new Date(i).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),M=i=>{d.value=i,V.value=!0},I=i=>{console.log("Simulating",i.no)};return R(()=>{j()}),(i,s)=>{const f=r("el-icon"),B=r("el-radio-button"),Q=r("el-radio-group"),q=r("el-input"),c=r("el-button"),u=r("el-table-column"),U=r("el-tag"),F=r("el-table"),G=r("el-pagination"),J=r("el-dialog"),O=X("loading");return _(),N("div",os,[t("div",ns,[t("div",ds,[t("div",us,[l(f,null,{default:a(()=>[l(g(Y))]),_:1})]),t("div",rs,[s[5]||(s[5]=t("div",{class:"label"},"待签发/审批",-1)),t("div",ps,o(A.value),1)])]),t("div",cs,[t("div",vs,[l(f,null,{default:a(()=>[l(g(Z))]),_:1})]),t("div",_s,[s[6]||(s[6]=t("div",{class:"label"},"执行中/许可中",-1)),t("div",fs,o(E.value),1)])]),t("div",gs,[t("div",ms,[l(f,null,{default:a(()=>[l(g(ss))]),_:1})]),t("div",ks,[s[7]||(s[7]=t("div",{class:"label"},"已归档",-1)),t("div",bs,o(H.value),1)])]),t("div",ws,[t("div",ys,[l(f,null,{default:a(()=>[l(g(ts))]),_:1})]),s[8]||(s[8]=t("div",{class:"info"},[t("div",{class:"label"},"本月合格率"),t("div",{class:"value"},"99.2%")],-1))])]),t("div",hs,[t("div",xs,[t("div",Cs,[l(Q,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=e=>h.value=e),class:"sc2-radio-group",onChange:L},{default:a(()=>[l(B,{label:"work"},{default:a(()=>[...s[9]||(s[9]=[n("工作票管理",-1)])]),_:1}),l(B,{label:"operation"},{default:a(()=>[...s[10]||(s[10]=[n("操作票管理",-1)])]),_:1})]),_:1},8,["modelValue"])]),t("div",zs,[l(q,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=e=>m.value=e),placeholder:"搜索票号/任务...","prefix-icon":g(W),class:"search-input"},null,8,["modelValue","prefix-icon"]),l(c,{type:"primary"},{default:a(()=>[l(f,null,{default:a(()=>[l(g(es))]),_:1}),s[11]||(s[11]=n(" 开票",-1))]),_:1})])]),h.value==="work"?$((_(),w(F,{key:0,data:D.value,class:"sc2-table",stripe:""},{default:a(()=>[l(u,{prop:"no",label:"票号",width:"160","show-overflow-tooltip":""},{default:a(({row:e})=>[t("span",Ts,o(e.no),1)]),_:1}),l(u,{label:"票种",width:"140"},{default:a(({row:e})=>[l(U,{type:e.category==="work_1"?"danger":"primary",effect:"dark",class:"ticket-tag"},{default:a(()=>[n(o(e.category==="work_1"?"第一种工作票":"第二种工作票"),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"stationName",label:"所属站点",width:"180"}),l(u,{prop:"task",label:"工作任务","min-width":"200","show-overflow-tooltip":""}),l(u,{label:"当前环节",width:"120"},{default:a(({row:e})=>[t("div",{class:p(["step-capsule",e.status])},o(e.currentStep),3)]),_:1}),l(u,{label:"关键人员",width:"180"},{default:a(({row:e})=>[t("div",Vs,[s[12]||(s[12]=t("span",{class:"role"},"负责人:",-1)),s[13]||(s[13]=n()),t("span",Ns,o(e.leader),1)])]),_:1}),l(u,{label:"时间范围",width:"200"},{default:a(({row:e})=>[t("div",Ss,[t("div",null,o(z(e.startTime)),1),s[14]||(s[14]=t("div",{class:"to"},"TO",-1)),t("div",null,o(z(e.endTime)),1)])]),_:1}),l(u,{label:"操作",fixed:"right",width:"180"},{default:a(({row:e})=>[l(c,{link:"",type:"primary",size:"small",onClick:P=>M(e)},{default:a(()=>[...s[15]||(s[15]=[n("详情",-1)])]),_:1},8,["onClick"]),e.status==="permit"?(_(),w(c,{key:0,link:"",type:"success",size:"small"},{default:a(()=>[...s[16]||(s[16]=[n("许可",-1)])]),_:1})):T("",!0),e.status==="audit"?(_(),w(c,{key:1,link:"",type:"warning",size:"small"},{default:a(()=>[...s[17]||(s[17]=[n("签发",-1)])]),_:1})):T("",!0),l(c,{link:"",size:"small",icon:"Printer"},{default:a(()=>[...s[18]||(s[18]=[n("打印",-1)])]),_:1})]),_:1})]),_:1},8,["data"])),[[O,y.value]]):$((_(),w(F,{key:1,data:D.value,class:"sc2-table",stripe:""},{default:a(()=>[l(u,{prop:"no",label:"票号",width:"160"}),l(u,{label:"票种",width:"120"},{default:a(()=>[l(U,{color:"#6200ea",effect:"dark",class:"ticket-tag op-tag"},{default:a(()=>[...s[19]||(s[19]=[n("倒闸操作票",-1)])]),_:1})]),_:1}),l(u,{prop:"stationName",label:"所属站点",width:"180"}),l(u,{prop:"task",label:"操作任务","min-width":"200","show-overflow-tooltip":""}),l(u,{label:"操作状态",width:"120"},{default:a(({row:e})=>[t("div",{class:p(["step-capsule",e.status])},o(e.currentStep),3)]),_:1}),l(u,{label:"监护/操作",width:"180"},{default:a(({row:e})=>[t("div",Ds,[s[20]||(s[20]=t("span",{class:"role"},"监护:",-1)),n(" "+o(e.guardian||"-"),1)]),t("div",Ms,[s[21]||(s[21]=t("span",{class:"role"},"操作:",-1)),n(" "+o(e.leader),1)])]),_:1}),l(u,{label:"操作",fixed:"right",width:"220"},{default:a(({row:e})=>[l(c,{link:"",type:"info",size:"small",icon:"Monitor",onClick:P=>I(e)},{default:a(()=>[...s[22]||(s[22]=[n("预演",-1)])]),_:1},8,["onClick"]),e.status==="executing"?(_(),w(c,{key:0,link:"",type:"success",size:"small"},{default:a(()=>[...s[23]||(s[23]=[n("执行",-1)])]),_:1})):T("",!0),l(c,{link:"",type:"primary",size:"small",onClick:P=>M(e)},{default:a(()=>[...s[24]||(s[24]=[n("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,y.value]]),t("div",Bs,[l(G,{"current-page":x.value,"onUpdate:currentPage":s[2]||(s[2]=e=>x.value=e),"page-size":C.value,"onUpdate:pageSize":s[3]||(s[3]=e=>C.value=e),layout:"total, sizes, prev, pager, next",total:S.value.length},null,8,["current-page","page-size","total"])])]),l(J,{modelValue:V.value,"onUpdate:modelValue":s[4]||(s[4]=e=>V.value=e),title:"作业票据详情",width:"900px",class:"sc2-dialog ticket-dialog","destroy-on-close":""},{default:a(()=>[d.value?(_(),N("div",Us,[t("div",Fs,[s[25]||(s[25]=t("div",{class:"step active"},"1. 草稿",-1)),s[26]||(s[26]=t("div",{class:"step-line active"},null,-1)),t("div",{class:p(["step",{active:["audit","permit","executing","finished"].includes(d.value.status)}])},"2. 签发/审核",2),t("div",{class:p(["step-line",{active:["permit","executing","finished"].includes(d.value.status)}])},null,2),t("div",{class:p(["step",{active:["permit","executing","finished"].includes(d.value.status)}])},"3. 许可/预演",2),t("div",{class:p(["step-line",{active:["executing","finished"].includes(d.value.status)}])},null,2),t("div",{class:p(["step",{active:["executing","finished"].includes(d.value.status)}])},"4. 执行",2),t("div",{class:p(["step-line",{active:d.value.status==="finished"}])},null,2),t("div",{class:p(["step",{active:d.value.status==="finished"}])},"5. 终结",2)]),t("div",Os,[t("div",Ps,[t("h2",null,o(d.value.category==="operation"?"倒闸操作票":"电力线路工作票"),1),t("div",$s,"NO: "+o(d.value.no),1)]),t("div",js,[s[27]||(s[27]=t("span",{class:"label"},"工作单位:",-1)),s[28]||(s[28]=n()),s[29]||(s[29]=t("span",{class:"val"},"检修一班",-1)),s[30]||(s[30]=t("span",{class:"label ml-4"},"编号:",-1)),s[31]||(s[31]=n()),t("span",As,o(d.value.id),1)]),t("div",Es,[s[32]||(s[32]=t("span",{class:"label"},"工作负责人:",-1)),s[33]||(s[33]=n()),t("span",Hs,o(d.value.leader),1),s[34]||(s[34]=t("span",{class:"label ml-4"},"班组:",-1)),s[35]||(s[35]=n()),s[36]||(s[36]=t("span",{class:"val"},"变电运维组",-1))]),t("div",Ls,[s[37]||(s[37]=t("span",{class:"label"},"工作任务:",-1)),t("div",Is,o(d.value.task),1)]),t("div",Qs,[s[38]||(s[38]=t("span",{class:"label"},"计划时间:",-1)),t("span",qs,o(z(d.value.startTime))+" 至 "+o(z(d.value.endTime)),1)]),t("div",Gs,[t("div",Js,o(d.value.category==="operation"?"操作顺序":"安全措施"),1),t("div",Ks,[(_(),N(ls,null,as(3,e=>t("div",{class:"check-item",key:e},[t("span",Rs,o(e)+".",1),t("span",Ws,"拉开 10"+o(e)+" 断路器，检查确在断开位置。",1),s[39]||(s[39]=t("span",{class:"check-box"},null,-1))])),64))])]),s[40]||(s[40]=t("div",{class:"sign-area"},[t("div",{class:"sign-box"},[t("span",{class:"lbl"},"签发人:"),t("span",{class:"sign-val"},"李四 (已签)")]),t("div",{class:"sign-box"},[t("span",{class:"lbl"},"许可人:"),t("span",{class:"sign-btn"},"点击签名")])],-1))])])):T("",!0)]),_:1},8,["modelValue"])])}}}),st=is(Xs,[["__scopeId","data-v-3c73aa70"]]);export{st as default};
