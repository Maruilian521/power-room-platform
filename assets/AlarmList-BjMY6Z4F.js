import{d as ue,az as ce,m,r as v,o as ve,c as f,b as t,j as l,l as o,A as r,t as n,w as _e,aA as pe,E as g,C as I,aB as me,af as fe,aC as j,au as ge,B as d,F as be,i as ye,ab as we,k as b,n as he,V as Ce,f as u,_ as Ve}from"./index-BFAmLiXm.js";import{u as ke}from"./device-Cstu3Uc2.js";const xe={class:"page-container"},Ae={class:"alarm-center"},Le={class:"dashboard-header"},Ue={class:"stat-card-item critical"},Se={class:"icon-wrapper"},ze={class:"info"},Ie={class:"value"},Ne={class:"stat-card-item warning"},Te={class:"icon-wrapper"},De={class:"info"},Be={class:"value"},Re={class:"stat-card-item ai"},Pe={class:"icon-wrapper"},Ee={class:"info"},Fe={class:"value"},$e={class:"stat-card-item today"},je={class:"icon-wrapper"},Me={class:"info"},Oe={class:"value"},We={class:"main-content module-card"},qe={class:"toolbar"},Ge={class:"left-tools"},He={class:"right-tools"},Je={class:"alarm-expand-detail"},Ke={key:0},Qe={key:1,class:"snapshot-preview"},Xe=["src"],Ye={class:"type-cell"},Ze={class:"pagination-container"},et={key:0,class:"sc2-info-panel detail-container"},tt={class:"header-main"},lt={class:"level-badge"},st={class:"title"},at={class:"time"},ot={class:"detail-body"},nt={class:"info-grid"},it={class:"info-item"},dt={class:"val"},rt={class:"info-item"},ut={class:"val"},ct={class:"info-item"},vt={class:"val"},_t={class:"info-item"},pt={class:"val highlight"},mt={class:"message-box"},ft={class:"content"},gt={key:0,class:"snapshot-section"},bt={class:"image-box"},yt=["src"],wt={key:0,class:"process-section"},ht=ue({__name:"AlarmList",setup(Ct){const w=ke(),{alarms:h,loading:M}=ce(w),T=m(()=>w.rooms||[]),k=v(""),x=v(""),A=v(""),y=v(""),L=v(1),U=v(20),C=v(!1),i=v(null),S=v({note:""}),O=m(()=>h.value.filter(a=>a.level==="critical").length),W=m(()=>h.value.filter(a=>a.level==="warning").length),q=m(()=>h.value.filter(a=>a.category==="ai").length),G=m(()=>{const a=new Date().toISOString().split("T")[0];return h.value.filter(e=>e.time.startsWith(a)).length}),D=m(()=>h.value.filter(a=>{const e=!k.value||a.category===k.value,c=!x.value||a.roomId===x.value,p=!A.value||a.level===A.value,N=!y.value||a.message.toLowerCase().includes(y.value.toLowerCase())||a.type.toLowerCase().includes(y.value.toLowerCase())||a.deviceName&&a.deviceName.includes(y.value);return e&&c&&p&&N})),H=m(()=>{const a=(L.value-1)*U.value;return D.value.slice(a,a+U.value)}),J=a=>({critical:"danger",warning:"warning",info:"info"})[a]||"info",B=a=>({critical:"严重",warning:"警告",info:"提示"})[a]||a,K=a=>({pending:"danger",processing:"warning",resolved:"success"})[a]||"",Q=a=>({pending:"待处理",processing:"处理中",resolved:"已解决"})[a]||a,X=a=>({power:"电力",environment:"环境",ai:"AI识别",security:"安防",device:"设备"})[a]||a,Y=a=>{const e=T.value.find(c=>c.id===a);return e?e.location:"未知位置"},Z=()=>{w.fetchAlarms()},ee=()=>{L.value=1},R=a=>{i.value=a,S.value.note="",C.value=!0},te=a=>{R(a)},le=async()=>{i.value&&(Ce.success("处理成功"),i.value.status="resolved",C.value=!1)};return ve(()=>{w.fetchRooms(),w.fetchAlarms()}),(a,e)=>{const c=r("el-icon"),p=r("el-radio-button"),N=r("el-radio-group"),z=r("el-option"),P=r("el-select"),E=r("el-input"),V=r("el-button"),_=r("el-table-column"),F=r("el-tag"),se=r("el-table"),ae=r("el-pagination"),oe=r("el-divider"),$=r("el-form-item"),ne=r("el-form"),ie=r("el-dialog"),de=pe("loading");return u(),f("div",xe,[t("div",Ae,[t("div",Le,[t("div",Ue,[t("div",Se,[l(c,null,{default:o(()=>[l(g(me))]),_:1})]),t("div",ze,[e[9]||(e[9]=t("div",{class:"label"},"严重告警",-1)),t("div",Ie,n(O.value),1)])]),t("div",Ne,[t("div",Te,[l(c,null,{default:o(()=>[l(g(fe))]),_:1})]),t("div",De,[e[10]||(e[10]=t("div",{class:"label"},"一般预警",-1)),t("div",Be,n(W.value),1)])]),t("div",Re,[t("div",Pe,[l(c,null,{default:o(()=>[l(g(j))]),_:1})]),t("div",Ee,[e[11]||(e[11]=t("div",{class:"label"},"AI 识别异常",-1)),t("div",Fe,n(q.value),1)])]),t("div",$e,[t("div",je,[l(c,null,{default:o(()=>[l(g(ge))]),_:1})]),t("div",Me,[e[12]||(e[12]=t("div",{class:"label"},"今日告警总数",-1)),t("div",Oe,n(G.value),1)])])]),t("div",We,[e[24]||(e[24]=t("div",{class:"module-header"},[t("span",{class:"title"},"告警监控台")],-1)),t("div",qe,[t("div",Ge,[l(N,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=s=>k.value=s),onChange:ee},{default:o(()=>[l(p,{label:""},{default:o(()=>[...e[13]||(e[13]=[d("全部",-1)])]),_:1}),l(p,{label:"power"},{default:o(()=>[...e[14]||(e[14]=[d("电力监控",-1)])]),_:1}),l(p,{label:"environment"},{default:o(()=>[...e[15]||(e[15]=[d("环境监测",-1)])]),_:1}),l(p,{label:"ai"},{default:o(()=>[...e[16]||(e[16]=[d("AI 识别",-1)])]),_:1}),l(p,{label:"security"},{default:o(()=>[...e[17]||(e[17]=[d("安防监控",-1)])]),_:1})]),_:1},8,["modelValue"])]),t("div",He,[l(P,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=s=>x.value=s),placeholder:"选择配电室",clearable:"",filterable:"",style:{width:"200px"}},{default:o(()=>[(u(!0),f(be,null,ye(T.value,s=>(u(),I(z,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(P,{modelValue:A.value,"onUpdate:modelValue":e[2]||(e[2]=s=>A.value=s),placeholder:"告警级别",clearable:"",style:{width:"120px"}},{default:o(()=>[l(z,{label:"严重",value:"critical"}),l(z,{label:"警告",value:"warning"}),l(z,{label:"信息",value:"info"})]),_:1},8,["modelValue"]),l(E,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=s=>y.value=s),placeholder:"搜索设备/告警内容","prefix-icon":"Search",style:{width:"250px"},clearable:""},null,8,["modelValue"]),l(V,{type:"primary",onClick:Z},{default:o(()=>[l(c,null,{default:o(()=>[l(g(we))]),_:1})]),_:1})])]),_e((u(),I(se,{data:H.value,style:{width:"100%"},stripe:""},{default:o(()=>[l(_,{type:"expand"},{default:o(s=>[t("div",Je,[t("p",null,[e[18]||(e[18]=t("strong",null,"告警详情：",-1)),d(n(s.row.message),1)]),t("p",null,[e[19]||(e[19]=t("strong",null,"位置信息：",-1)),d(n(Y(s.row.roomId)),1)]),s.row.value?(u(),f("p",Ke,[e[20]||(e[20]=t("strong",null,"触发值：",-1)),d(n(s.row.value),1)])):b("",!0),t("p",null,[e[21]||(e[21]=t("strong",null,"发生时间：",-1)),d(n(s.row.time),1)]),s.row.snapshotUrl?(u(),f("div",Qe,[t("img",{src:s.row.snapshotUrl,alt:"现场快照"},null,8,Xe)])):b("",!0)])]),_:1}),l(_,{prop:"time",label:"发生时间",width:"180",sortable:""}),l(_,{label:"告警级别",width:"100"},{default:o(({row:s})=>[l(F,{type:J(s.level),effect:"dark"},{default:o(()=>[d(n(B(s.level)),1)]),_:2},1032,["type"])]),_:1}),l(_,{label:"���警类型",width:"150"},{default:o(({row:s})=>[t("div",Ye,[s.category==="ai"?(u(),I(c,{key:0,class:"ai-icon"},{default:o(()=>[l(g(j))]),_:1})):b("",!0),t("span",null,n(s.type),1)])]),_:1}),l(_,{prop:"roomName",label:"所属配电室","min-width":"150"}),l(_,{prop:"message",label:"告警内容","min-width":"300","show-overflow-tooltip":""}),l(_,{label:"状态",width:"100"},{default:o(({row:s})=>[l(F,{type:K(s.status)},{default:o(()=>[d(n(Q(s.status)),1)]),_:2},1032,["type"])]),_:1}),l(_,{fixed:"right",label:"操作",width:"180"},{default:o(({row:s})=>[l(V,{link:"",type:"primary",size:"small",onClick:re=>R(s)},{default:o(()=>[...e[22]||(e[22]=[d("查看",-1)])]),_:1},8,["onClick"]),s.status!=="resolved"?(u(),I(V,{key:0,link:"",type:"warning",size:"small",onClick:re=>te(s)},{default:o(()=>[...e[23]||(e[23]=[d(" 处理 ",-1)])]),_:1},8,["onClick"])):b("",!0)]),_:1})]),_:1},8,["data"])),[[de,g(M)]]),t("div",Ze,[l(ae,{"current-page":L.value,"onUpdate:currentPage":e[4]||(e[4]=s=>L.value=s),"page-size":U.value,"onUpdate:pageSize":e[5]||(e[5]=s=>U.value=s),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:D.value.length},null,8,["current-page","page-size","total"])])]),l(ie,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=s=>C.value=s),title:"告警详情处理",width:"700px","destroy-on-close":"",class:"sc2-dialog"},{default:o(()=>[i.value?(u(),f("div",et,[t("div",{class:he(["detail-header",i.value.level])},[t("div",tt,[t("span",lt,n(B(i.value.level)),1),t("span",st,n(i.value.type)+" - "+n(i.value.roomName),1)]),t("div",at,n(i.value.time),1)],2),t("div",ot,[t("div",nt,[t("div",it,[e[25]||(e[25]=t("span",{class:"label"},"告警ID:",-1)),t("span",dt,n(i.value.id),1)]),t("div",rt,[e[26]||(e[26]=t("span",{class:"label"},"设备名称:",-1)),t("span",ut,n(i.value.deviceName||"-"),1)]),t("div",ct,[e[27]||(e[27]=t("span",{class:"label"},"告警分类:",-1)),t("span",vt,n(X(i.value.category)),1)]),t("div",_t,[e[28]||(e[28]=t("span",{class:"label"},"触发值:",-1)),t("span",pt,n(i.value.value||"-"),1)])]),t("div",mt,[e[29]||(e[29]=t("div",{class:"label"},"详细描述:",-1)),t("div",ft,n(i.value.message),1)]),i.value.snapshotUrl?(u(),f("div",gt,[e[30]||(e[30]=t("div",{class:"label"},"现场快照 (AI/安防):",-1)),t("div",bt,[t("img",{src:i.value.snapshotUrl,alt:"Snapshot"},null,8,yt)])])):b("",!0)]),i.value.status!=="resolved"?(u(),f("div",wt,[l(oe,{"content-position":"left"},{default:o(()=>[...e[31]||(e[31]=[d("处置操作",-1)])]),_:1}),l(ne,{model:S.value,"label-width":"80px"},{default:o(()=>[l($,{label:"处理意见"},{default:o(()=>[l(E,{modelValue:S.value.note,"onUpdate:modelValue":e[6]||(e[6]=s=>S.value.note=s),type:"textarea",rows:"3",placeholder:"请输入处理情况说明..."},null,8,["modelValue"])]),_:1}),l($,null,{default:o(()=>[l(V,{type:"primary",onClick:le},{default:o(()=>[...e[32]||(e[32]=[d("确认处理",-1)])]),_:1}),l(V,{onClick:e[7]||(e[7]=s=>C.value=!1)},{default:o(()=>[...e[33]||(e[33]=[d("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])):b("",!0)])):b("",!0)]),_:1},8,["modelValue"])])])}}}),xt=Ve(ht,[["__scopeId","data-v-0ffe8e9f"]]);export{xt as default};
